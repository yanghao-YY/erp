/*
* Copyright (c) 2014 Johannes Mittendorfer (http://johannes-mittendorfer.com)
* Licensed under the MIT License (LICENSE.txt).
*
* Version 2.1.1
* Build 2014-10-07
*/

var EAN13,pluginName;pluginName=null,EAN13=function(){function a(a,b,c){var d;if(this.element=a,this.number=b,this.settings={number:!0,prefix:!0,color:"#000",debug:!1,onValid:function(){},onInvalid:function(){},onSuccess:function(){},onError:function(){}},c)for(d in c)this.settings[d]=c[d];this._name=pluginName,this.init()}return a.prototype.settings={},a.prototype.init=function(){var a,b;return 12===this.number.length&&(a=this.generateCheckDigit(this.number),this.number+=a),13===this.number.length?(this.validate()?this.settings.onValid.call():this.settings.onInvalid.call(),b=this.getCode(),this.draw(b)):this.settings.onError.call()},a.prototype.getCode=function(){var a,b,c,d,e,f,g,h,i;for(g=["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],h=["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],i=["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],c=["xxxxxx","xxyxyy","xxyyxy","xxyyyx","xyxxyy","xyyxxy","xyyyxx","xyxyxy","xyxyyx","xyyxyx"],b="",a=c[parseInt(this.number.substr(0,1),10)].split(""),f=this.number.substr(1),e=f.split(""),d=0;6>d;)b+="x"===a[d]?g[e[d]]:h[e[d]],d++;for(d=6;12>d;)b+=i[e[d]],d++;return b},a.prototype.clear=function(a){return a.clearRect(0,0,this.element.width,this.element.height)},a.prototype.draw=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(h={prefix_offset:.06,font_stretch:.073,border_line_height_number:.9,border_line_height:1,line_height:.9,font_size:.15,font_y:1.03,text_offset:4.5},m=this.settings.prefix?this.element.width-this.element.width*h.prefix_offset:this.element.width,this.settings.number?(b=h.border_line_height_number*this.element.height,e=h.line_height*b):(b=h.border_line_height*this.element.height,e=b),g=m/95,this.element.getContext){for(d=this.element.getContext("2d"),this.clear(d),d.fillStyle=this.settings.color,i=this.settings.number&&this.settings.prefix?this.element.width*h.prefix_offset:0,j=a.split(""),d.fillRect(i,0,g,b),i+=2*g,d.fillRect(i,0,g,b),i+=g,f=0;42>f;)"1"===j[f]&&d.fillRect(i,0,Math.floor(g)+1,e),i+=g,f++;for(i+=g,d.fillRect(i,0,g,b),i+=2*g,d.fillRect(i,0,g,b),i+=2*g,f=42;84>f;)"1"===j[f]&&d.fillRect(i,0,Math.floor(g)+1,e),i+=g,f++;if(d.fillRect(i,0,g,b),i+=2*g,d.fillRect(i,0,g,b),this.settings.number&&(d.font=h.font_size*e+"px monospace",l=this.number.substr(0,1),this.settings.prefix&&d.fillText(l,0,b*h.font_y),k=g*h.text_offset+(this.settings.prefix?h.prefix_offset*this.element.width:0),c=this.number.substr(1,6).split(""),$.each(c,function(a,c){return d.fillText(c,k,b*h.font_y),k+=h.font_stretch*m}),k=49*g+(this.settings.prefix?h.prefix_offset*this.element.width:0)+h.text_offset,$.each(this.number.substr(7).split(""),function(a,c){return d.fillText(c,k,b*h.font_y),k+=h.font_stretch*m})),this.settings.debug)for(n=o=0,p=2*g;p>0?m>=o:o>=m;n=o+=p)d.beginPath(),d.rect(n,.4*e,g,.1*e),d.fillStyle="red",d.fill();return this.settings.onSuccess.call()}return this.settings.onError.call()},a.prototype.generateCheckDigit=function(a){var b,c;return c=0,b=a.split(""),$.each(b,function(a,b){return c+=a%2===0?parseInt(b,10):3*parseInt(b,10)}),10-c%10%10},a.prototype.validate=function(){return parseInt(this.number.slice(-1),10)===this.generateCheckDigit(this.number.slice(0,-1))},a}(),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=EAN13);